<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF to PPTX Converter</title>
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* å…¨ä½“ã®è¨­å®šï¼šå¯æ„›ã‚‰ã—ãä¸¸ã¿ã®ã‚ã‚‹ãƒ•ã‚©ãƒ³ãƒˆã¨è‰²ä½¿ã„ */
        :root {
            --primary: #FF7E5F; /* æ¸©ã‹ã¿ã®ã‚ã‚‹ã‚ªãƒ¬ãƒ³ã‚¸ */
            --secondary: #FEB47B;
            --pdf-color: #EF4444;
            --ppt-color: #F97316;
            --bg-color: #FFF5F2;
            --text-color: #4B5563;
        }

        body {
            font-family: 'M PLUS Rounded 1c', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            overflow: hidden; /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®ã¯ã¿å‡ºã—é˜²æ­¢ */
        }

        /* ãƒ¡ã‚¤ãƒ³ã‚«ãƒ¼ãƒ‰ */
        .container {
            background: white;
            width: 100%;
            max-width: 420px;
            padding: 3rem 2rem;
            border-radius: 30px;
            box-shadow: 0 20px 40px rgba(255, 126, 95, 0.15);
            text-align: center;
            position: relative;
            transition: transform 0.3s;
        }

        h1 {
            font-size: 1.4rem;
            color: #333;
            margin-bottom: 0.5rem;
        }
        
        p.subtitle {
            font-size: 0.9rem;
            color: #888;
            margin-bottom: 2rem;
        }

        /* --- [ãƒ¡ã‚¤ãƒ³] å¤‰èº«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒªã‚¢ --- */
        .magic-stage {
            height: 120px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 2rem;
            position: relative;
        }

        /* æ›¸é¡ã‚¢ã‚¤ã‚³ãƒ³ */
        .doc-icon {
            width: 70px;
            height: 90px;
            border-radius: 8px;
            position: absolute;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2rem;
            font-weight: bold;
            color: white;
            transition: all 0.5s ease;
            box-shadow: 0 8px 15px rgba(0,0,0,0.1);
        }

        /* PDFã®çŠ¶æ…‹ */
        .doc-icon.pdf {
            background: var(--pdf-color);
            z-index: 2;
        }
        .doc-icon.pdf::after { content: "PDF"; font-size: 1.2rem; }

        /* PPTã®çŠ¶æ…‹ */
        .doc-icon.ppt {
            background: var(--ppt-color);
            transform: scale(0); /* æœ€åˆã¯éš ã‚Œã¦ã„ã‚‹ */
            opacity: 0;
            z-index: 1;
        }
        .doc-icon.ppt::after { content: "P"; font-size: 2rem; }

        /* å¤‰æ›ä¸­ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å‹•ä½œ */
        .converting .doc-icon.pdf {
            animation: magicSpin 2s infinite ease-in-out;
        }

        @keyframes magicSpin {
            0% { transform: rotate(0deg) scale(1); border-radius: 8px; }
            50% { transform: rotate(180deg) scale(0.8); border-radius: 50%; background: var(--secondary); }
            100% { transform: rotate(360deg) scale(1); border-radius: 8px; }
        }

        /* ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒªã‚¢ */
        .upload-box {
            border: 3px dashed #FFD1C1;
            border-radius: 20px;
            padding: 2rem;
            cursor: pointer;
            transition: 0.3s;
            background: #FFFBF9;
        }
        .upload-box:hover {
            border-color: var(--primary);
            background: #FFF0EB;
            transform: translateY(-2px);
        }
        
        .file-name-display {
            font-weight: bold;
            color: var(--primary);
            display: none;
            word-break: break-all;
            margin-top: 10px;
        }

        /* ãƒœã‚¿ãƒ³ */
        .btn-magic {
            background: linear-gradient(135deg, #FF7E5F, #FEB47B);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            margin-top: 1.5rem;
            width: 100%;
            box-shadow: 0 10px 20px rgba(255, 126, 95, 0.3);
            transition: 0.3s;
        }
        .btn-magic:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 15px 30px rgba(255, 126, 95, 0.4);
        }
        .btn-magic:disabled {
            background: #ccc;
            cursor: default;
            box-shadow: none;
            transform: none;
        }

        /* --- æ–°ãƒ»ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ --- */
        .progress-wrapper {
            margin-top: 20px;
            display: none; /* æœ€åˆã¯éè¡¨ç¤º */
        }
        
        .progress-track {
            width: 100%;
            height: 12px;
            background: #eee;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }
        
        .progress-fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #FF7E5F, #FEB47B);
            border-radius: 10px;
            transition: width 0.2s linear; /* ã‚«ã‚¯ã¤ã‹ã›ãªã„ */
            position: relative;
        }
        
        /* ç¸æ¨¡æ§˜ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .progress-fill::after {
            content: "";
            position: absolute;
            top: 0; left: 0; bottom: 0; right: 0;
            background-image: linear-gradient(
                45deg, 
                rgba(255,255,255,0.2) 25%, 
                transparent 25%, 
                transparent 50%, 
                rgba(255,255,255,0.2) 50%, 
                rgba(255,255,255,0.2) 75%, 
                transparent 75%, 
                transparent
            );
            background-size: 20px 20px;
            animation: moveStripe 1s linear infinite;
        }
        
        @keyframes moveStripe {
            0% { background-position: 0 0; }
            100% { background-position: 20px 20px; }
        }

        .status-msg {
            margin-top: 10px;
            font-size: 0.9rem;
            color: var(--primary);
            font-weight: bold;
            min-height: 1.2em;
        }

        /* æˆåŠŸæ™‚ã®æ¼”å‡º */
        .success-overlay {
            display: none;
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes popIn {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

    </style>
</head>
<body>

    <div class="container">
        <h1>PDF to PPTX Magic</h1>
        <p class="subtitle">AIãŒãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’è§£æã—ã¦å¤‰æ›ã—ã¾ã™</p>

        <div class="magic-stage" id="stage">
            <div class="doc-icon pdf" id="iconPdf"></div>
            <div class="doc-icon ppt" id="iconPpt"></div>
        </div>

        <form id="convertForm">
            <label class="upload-box" id="dropZone">
                <input type="file" name="pdf" id="fileInput" accept=".pdf" hidden>
                <span style="font-size: 2rem;">ğŸ“‚</span><br>
                <span id="dropText">ã“ã“ã«PDFã‚’ç½®ã„ã¦ã­</span>
                <div class="file-name-display" id="fileName"></div>
            </label>

            <div class="progress-wrapper" id="progressWrapper">
                <div class="progress-track">
                    <div class="progress-fill" id="progressBar"></div>
                </div>
                <div class="status-msg" id="statusMsg">æº–å‚™ä¸­...</div>
            </div>

            <button type="submit" class="btn-magic" id="submitBtn">é­”æ³•ã‚’ã‹ã‘ã‚‹ âœ¨</button>
        </form>

        <div class="success-overlay" id="successOverlay">
            <h2 style="color: #F97316;">å¤‰æ›å®Œäº†ï¼ğŸ‰</h2>
            <p>ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãŒå§‹ã¾ã‚Šã¾ã™...</p>
        </div>
    </div>

    <script>
        const stage = document.getElementById('stage');
        const iconPdf = document.getElementById('iconPdf');
        const iconPpt = document.getElementById('iconPpt');
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const fileNameDisplay = document.getElementById('fileName');
        const dropText = document.getElementById('dropText');
        const submitBtn = document.getElementById('submitBtn');
        const progressWrapper = document.getElementById('progressWrapper');
        const progressBar = document.getElementById('progressBar');
        const statusMsg = document.getElementById('statusMsg');
        const successOverlay = document.getElementById('successOverlay');

        // ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(e => {
            dropZone.addEventListener(e, (ev) => { ev.preventDefault(); ev.stopPropagation(); });
        });
        dropZone.addEventListener('drop', (e) => handleFile(e.dataTransfer.files[0]));
        fileInput.addEventListener('change', () => handleFile(fileInput.files[0]));

        function handleFile(file) {
            if (file) {
                fileInput.files = createFileList(file); // inputã«ã‚‚ã‚»ãƒƒãƒˆ
                fileNameDisplay.textContent = file.name;
                fileNameDisplay.style.display = 'block';
                dropText.style.display = 'none';
            }
        }
        // FileListä½œæˆãƒ˜ãƒ«ãƒ‘ãƒ¼
        function createFileList(file) {
            const dt = new DataTransfer();
            dt.items.add(file);
            return dt.files;
        }

        const messages = [
            "æ›¸é¡ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...",
            "ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’è§£æä¸­...",
            "ãƒ•ã‚©ãƒ³ãƒˆã‚’ Meiryo UI ã«å¤‰æ›´ä¸­...",
            "ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’çµ„ã¿ç«‹ã¦ã¦ã„ã¾ã™...",
            "ãƒ‡ã‚¶ã‚¤ãƒ³ã‚’æ•´ãˆã¦ã„ã¾ã™...",
            "ä»•ä¸Šã’ã®é­”æ³•ã‚’ã‹ã‘ã¦ã„ã¾ã™...",
            "ã‚ã¨å°‘ã—ï¼é ‘å¼µã£ã¦ã„ã¾ã™..."
        ];

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!fileInput.files.length) return alert('PDFã‚’é¸ã‚“ã§ãã ã•ã„ï¼');

            // --- UIåˆ‡ã‚Šæ›¿ãˆ ---
            submitBtn.style.display = 'none';
            dropZone.style.display = 'none';
            progressWrapper.style.display = 'block';
            stage.classList.add('converting'); // ã‚¢ã‚¤ã‚³ãƒ³å›è»¢é–‹å§‹

            // --- é€²æ—ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆæ¸›è¡°æ–¹å¼ï¼‰ ---
            let currentProgress = 0;
            let targetProgress = 95; // 95%ã‚’ç›®æŒ‡ã—ã¦é€²ã‚€
            let speed = 2.0; // åˆé€Ÿ

            const timer = setInterval(() => {
                // ç¾åœ¨å€¤ã¨ç›®æ¨™å€¤ã®å·®åˆ†ã‚’ã¨ã£ã¦ã€å°‘ã—ãšã¤é€²ã‚€ï¼ˆZenodã®ãƒ‘ãƒ©ãƒ‰ãƒƒã‚¯ã‚¹çš„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒï¼‰
                // ã“ã‚Œã«ã‚ˆã‚Šã€æœ€åˆã¯é€Ÿãã€å¾ŒåŠã¯ã‚†ã£ãã‚Šã«ãªã‚‹ãŒã€æ±ºã—ã¦æ­¢ã¾ã‚‰ãªã„
                const diff = targetProgress - currentProgress;
                
                if (diff > 0.5) {
                    currentProgress += diff * 0.05; // æ®‹ã‚Šã®5%ãšã¤é€²ã‚€
                } else {
                    currentProgress += 0.1; // æ¥µé™ã¾ã§è¿‘ã¥ã„ãŸã‚‰å¾®é€Ÿå‰é€²
                }

                // 99%ã§ã‚­ãƒ£ãƒƒãƒ—ã™ã‚‹ï¼ˆå®Œäº†é€šçŸ¥ãŒæ¥ã‚‹ã¾ã§ï¼‰
                if (currentProgress >= 99) currentProgress = 99;

                progressBar.style.width = `${currentProgress}%`;

                // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸åˆ‡ã‚Šæ›¿ãˆï¼ˆé€²æ—åº¦ã«åˆã‚ã›ã¦ï¼‰
                const msgIndex = Math.min(
                    messages.length - 1, 
                    Math.floor((currentProgress / 100) * messages.length)
                );
                statusMsg.textContent = messages[msgIndex];

            }, 200); // 0.2ç§’ã”ã¨ã«æ›´æ–°

            try {
                const formData = new FormData(document.getElementById('convertForm'));
                const response = await fetch('/convert', { method: 'POST', body: formData });

                if (!response.ok) throw new Error('å¤‰æ›ã‚¨ãƒ©ãƒ¼');

                // --- å®Œäº†æ¼”å‡º ---
                clearInterval(timer);
                progressBar.style.width = '100%';
                statusMsg.textContent = "å®Œæˆã—ã¾ã—ãŸï¼";
                
                // å›è»¢ã‚’æ­¢ã‚ã¦ã€ãƒãƒ³ãƒƒã¨PPTã«å¤‰èº«
                stage.classList.remove('converting');
                iconPdf.style.transform = "scale(0) rotate(360deg)"; // PDFæ¶ˆãˆã‚‹
                iconPdf.style.opacity = "0";
                
                iconPpt.style.transform = "scale(1.2) rotate(0deg)"; // PPTç¾ã‚Œã‚‹
                iconPpt.style.opacity = "1";
                
                setTimeout(() => {
                    iconPpt.style.transform = "scale(1) rotate(0deg)";
                    successOverlay.style.display = 'block';
                    progressWrapper.style.display = 'none';
                }, 300);

                // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                const originalName = fileInput.files[0].name;
                a.download = originalName.replace(/\.pdf$/i, '.pptx');
                document.body.appendChild(a);
                a.click();
                a.remove();

                // 5ç§’å¾Œã«ãƒªã‚»ãƒƒãƒˆ
                setTimeout(() => {
                    location.reload();
                }, 5000);

            } catch (err) {
                clearInterval(timer);
                alert('å¤‰æ›ã«å¤±æ•—ã—ã¾ã—ãŸ... ã‚‚ã†ä¸€åº¦è©¦ã—ã¦ãã ã•ã„ã€‚');
                location.reload();
            }
        });
    </script>
</body>
</html>